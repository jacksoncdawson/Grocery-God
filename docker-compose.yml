services:
  safeway-local:
    build:
      context: .
      dockerfile: Dockerfile
    image: safeway-scraper:local
    env_file:
      - .env.local
    environment:
      AWS_REGION: $REGION
    volumes:
      - ${HOME}/.aws:/root/.aws:ro
      - ${HOME}/.aws/sso/cache:/root/.aws/sso/cache:ro
    command: >
      python -c "from grocery_god.pipelines.safeway_lambda import handler; print(handler({}, None))"

        # Build an amd64 image for ECR/Lambda; no need to run it here
        
  safeway-remote:
    build:
      context: .
      dockerfile: Dockerfile
    image: safeway-scraper:remote
    platform: linux/amd64
    profiles: ["build-only"] 